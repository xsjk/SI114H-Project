## 坐标变换

### 记号

| 记号                     | 意义                                                     | 类型                             | 坐标表示                                                     |
| ------------------------ | -------------------------------------------------------- | -------------------------------- | ------------------------------------------------------------ |
| $f$                      | 一个2维空间中的标量场                                    | $\mathbb{R}$                     |                                                              |
| $\mathbf{f}$             | 一个2维空间中的矢量场                                    | $\mathbb{R}^2$                   |                                                              |
| $\mathbf{F}$             | 一个2维空间中的张量场                                    | $\mathbb{R}^2\times\mathbb{R}^2$ |                                                              |
| $f(x,y)$                 | 映射$f$在直角坐标下的函数表示                            | $(x,y)\rightarrow f$             | $f(x,y)$                                                     |
| $\mathbf{f}(x,y)$        | 映射$\mathbf{f}$在直角坐标下的函数表示                   | $(x,y)\rightarrow\mathbf{f}$     | $\begin{pmatrix}\mathbf{f}_x(x,y)\\\mathbf{f}_y(x,y)\end{pmatrix}$ |
| $\mathbf{F}(x,y)$        | 映射$\mathbf{F}$在直角坐标下的函数表示                   | $(x,y)\rightarrow\mathbf{F}$     | $\begin{pmatrix}\mathbf{F}_{xx}(x,y)&\mathbf{F}_{xy}(x,y)\\\mathbf{F}_{yx}(x,y)&\mathbf{F}_{yy}(x,y)\end{pmatrix}$ |
| $g(u,v)$                 | $f$在三角形参数空间的坐标表示                            | $(u,v)\rightarrow f$             | $g(u,v)$                                                     |
| $\mathbf{g}(u,v)$        | $(u,v)\rightarrow\mathbf{f}$ 的函数表示                  | $(u,v)\rightarrow\mathbf{f}$     | $\begin{pmatrix}\mathbf{g}_u(u,v)\\\mathbf{g}_v(u,v)\end{pmatrix}$ |
| $\mathbf{G}(u,v)$        | 定义在三角形参数空间的一个张量值函数                     | $(u,v)\rightarrow\mathbf{F}$     | $\begin{pmatrix}\mathbf{G}_{uu}(u,v)&\mathbf{G}_{uv}(u,v)\\\mathbf{G}_{vu}(v,u)&\mathbf{G}_{vv}(u,v)\end{pmatrix}$ |
| $\nabla f$               | $f$的梯度                                                | $\mathbb{R}^2$                   | $\begin{pmatrix}\frac{\partial f}{\partial x}\\\frac{\partial f}{\partial y}\end{pmatrix}$ |
| $\nabla\cdot \mathbf{f}$ | $\mathbf{f}$的散度                                       | $\mathbb{R}$                     | $\frac{\partial f}{\partial x}+\frac{\partial f}{\partial y}$ |
| $\nabla\mathbf{f}$       | $\mathbf{f}$的梯度                                       | $\mathbb{R}^2\times\mathbb{R}^2$ | $\begin{pmatrix}\frac{\partial\mathbf{f}_x}{\partial x}&\frac{\partial\mathbf{f}_y}{\partial x}\\\frac{\partial\mathbf{f}_x}{\partial y}&\frac{\partial\mathbf{f}_y}{\partial y}\end{pmatrix}$ |
| $\nabla\cdot\mathbf{F}$  | $\mathbf{F}$的散度                                       | $\mathbb{R}$                     | $\begin{pmatrix}\frac{\partial\mathbf{F}_{xx}}{\partial x}+\frac{\partial\mathbf{F}_{yx}}{\partial y}\\\frac{\partial\mathbf{F}_{xy}}{\partial x}+\frac{\partial\mathbf{F}_{yy}}{\partial y}\end{pmatrix}$ |
| $\nabla g$               | $g$的梯度                                                | $\mathbb{R}^2$                   | $\begin{pmatrix}\frac{\partial g}{\partial u}\\\frac{\partial g}{\partial v}\end{pmatrix}$ |
| $\nabla\cdot \mathbf{g}$ | $\mathbf{g}$的散度                                       | $\mathbb{R}$                     | $\frac{\partial g}{\partial u}+\frac{\partial g}{\partial v}$ |
| $\nabla\mathbf{g}$       | $\mathbf{g}$的梯度                                       | $\mathbb{R}^2\times\mathbb{R}^2$ | $\begin{pmatrix}\frac{\partial\mathbf{g}_u}{\partial u}&\frac{\partial\mathbf{g}_v}{\partial u}\\\frac{\partial\mathbf{g}_u}{\partial v}&\frac{\partial\mathbf{f}_v}{\partial v}\end{pmatrix}$ |
| $\nabla\cdot\mathbf{G}$  | $\mathbf{G}$的散度                                       | $\mathbb{R}^2$                   | $\begin{pmatrix}\frac{\partial\mathbf{G}_{uu}}{\partial u}+\frac{\partial\mathbf{G}_{vu}}{\partial v}\\\frac{\partial\mathbf{G}_{uv}}{\partial u}+\frac{\partial\mathbf{G}_{vv}}{\partial v}\end{pmatrix}$ |
| $\mathbf{J}$             | 从直角坐标(x,y)变换到三角形参数空间坐标(u,v)的雅可比矩阵 | $\mathbb{R}^2\times\mathbb{R}^2$ | $\begin{pmatrix}\frac{\partial u}{\partial x} & \frac{\partial u}{\partial y} \\ \frac{\partial v}{\partial x} & \frac{\partial v}{\partial y}\end{pmatrix}$ |
| $\mathbf{u}$             | 三角形参数空间中的一个基向量                             | $\mathbb{R}^2$                   | $\begin{pmatrix}\mathbf{u}_x\\\mathbf{u}_y\end{pmatrix}$     |
| $\mathbf{v}$             | 三角形参数空间中的另一个基向量                           | $\mathbb{R}^2$                   | $\begin{pmatrix}\mathbf{v}_x\\\mathbf{v}_y\end{pmatrix}$     |

### 关系

$$
f(x,y) = g(u,v) \\
\mathbf{f}(x,y) = \mathbf{g}(u,v) \\
\mathbf{F}(x,y) = \mathbf{G}(u,v)
$$

$$
\begin{pmatrix}
	x \\ y
\end{pmatrix} 
= 
\begin{pmatrix}
	\mathbf{u} & \mathbf{v}
\end{pmatrix}
=
\begin{pmatrix}
    \mathbf{u}_x & \mathbf{v}_x \\
    \mathbf{u}_y & \mathbf{v}_y
\end{pmatrix}
\begin{pmatrix}
	u \\ v
\end{pmatrix}
$$

$$
\begin{pmatrix}
	u \\ v
\end{pmatrix}
=
\frac{
    \begin{pmatrix}
        \mathbf{v}_y & -\mathbf{v}_x \\
        -\mathbf{u}_y & \mathbf{u}_x
    \end{pmatrix}
    \begin{pmatrix}
        x \\ y
    \end{pmatrix}
}{
	\mathbf{u}_x\mathbf{v}_y-\mathbf{u}_y\mathbf{v}_x
}
$$

$$
\mathbf{J}
=
\begin{pmatrix}
    \frac{\partial u}{\partial x} & \frac{\partial u}{\partial y} \\
    \frac{\partial v}{\partial x} & \frac{\partial v}{\partial y}
\end{pmatrix}
=
\frac{
    \begin{pmatrix}
        \mathbf{v}_y & -\mathbf{v}_x \\
        -\mathbf{u}_y & \mathbf{u}_x
    \end{pmatrix}
}{
	\mathbf{u}_x\mathbf{v}_y-\mathbf{u}_y\mathbf{v}_x
}
$$

$$
\nabla f 
=
\begin{pmatrix}
	\frac{\partial f}{\partial x} \\
	\frac{\partial f}{\partial y}
\end{pmatrix}
=
\begin{pmatrix}
	\frac{\partial f}{\partial u}\frac{\partial u}{\partial x}
  + \frac{\partial f}{\partial v}\frac{\partial v}{\partial x} \\
	\frac{\partial f}{\partial u}\frac{\partial u}{\partial y}
  + \frac{\partial f}{\partial v}\frac{\partial v}{\partial y} \\
\end{pmatrix}
=
\begin{pmatrix}
    \frac{\partial u}{\partial x} & \frac{\partial v}{\partial x} \\
    \frac{\partial u}{\partial y} & \frac{\partial v}{\partial y}
\end{pmatrix}
\begin{pmatrix}
    \frac{\partial f}{\partial u} \\
    \frac{\partial f}{\partial v}
\end{pmatrix}
=
\mathbf{J}^T\nabla g
$$

$$
\nabla\cdot\mathbf{f}
=
\frac{\partial\mathbf{f}_x}{\partial x} + 
\frac{\partial\mathbf{f}_y}{\partial y}
=
\frac{\partial\mathbf{f}_x}{\partial u} \frac{\partial u}{\partial x} +
\frac{\partial\mathbf{f}_x}{\partial v} \frac{\partial v}{\partial x} +
\frac{\partial\mathbf{f}_y}{\partial u} \frac{\partial u}{\partial y} +
\frac{\partial\mathbf{f}_y}{\partial v} \frac{\partial v}{\partial y}
=
\begin{pmatrix}
\frac{\partial\mathbf{f}_x}{\partial u} & \frac{\partial\mathbf{f}_y}{\partial u} \\
\frac{\partial\mathbf{f}_x}{\partial v} & \frac{\partial\mathbf{f}_y}{\partial v}
\end{pmatrix} :
\begin{pmatrix}
\frac{\partial u}{\partial x} & \frac{\partial u}{\partial y} \\
\frac{\partial v}{\partial x} & \frac{\partial v}{\partial y}
\end{pmatrix}
=
\nabla \mathbf{g} : \mathbf{J}
$$

$$
\nabla \cdot \mathbf{F} 
=
\begin{pmatrix}
    \nabla \cdot \mathbf{F}_x \\ 
    \nabla \cdot \mathbf{F}_y
\end{pmatrix}
= 
\begin{pmatrix}
    \frac{\partial\mathbf{F}_{xx}}{\partial x} + \frac{\partial\mathbf{F}_{xy}}{\partial y} \\
    \frac{\partial\mathbf{F}_{yx}}{\partial x} + \frac{\partial\mathbf{F}_{yy}}{\partial y}
\end{pmatrix} 
=
\begin{pmatrix}
    \frac{\partial\mathbf{F}_{xx}}{\partial u}\frac{\partial u}{\partial x} + 
    \frac{\partial\mathbf{F}_{xx}}{\partial v}\frac{\partial v}{\partial x} +
    \frac{\partial\mathbf{F}_{xy}}{\partial u}\frac{\partial u}{\partial y} + 
    \frac{\partial\mathbf{F}_{xy}}{\partial v}\frac{\partial v}{\partial y} \\
    \frac{\partial\mathbf{F}_{yx}}{\partial u}\frac{\partial u}{\partial x} + 
    \frac{\partial\mathbf{F}_{yx}}{\partial v}\frac{\partial v}{\partial x} +
    \frac{\partial\mathbf{F}_{yy}}{\partial u}\frac{\partial u}{\partial y} + 
    \frac{\partial\mathbf{F}_{yy}}{\partial v}\frac{\partial v}{\partial y} \\
\end{pmatrix}
=
\begin{pmatrix}
\nabla \mathbf{G}_u : \mathbf{J} \\
\nabla \mathbf{G}_v : \mathbf{J}
\end{pmatrix}
$$

$$
\nabla\mathbf{f}
=
\begin{pmatrix}\frac{\partial\mathbf{f}_x}{\partial x}&\frac{\partial\mathbf{f}_y}{\partial x}\\\frac{\partial\mathbf{f}_x}{\partial y}&\frac{\partial\mathbf{f}_y}{\partial y}\end{pmatrix}
=
\begin{pmatrix}
    \frac{\partial\mathbf{f}_x}{\partial u}\frac{\partial u}{\partial x} +
    \frac{\partial\mathbf{f}_x}{\partial v}\frac{\partial v}{\partial x} &
    
    \frac{\partial\mathbf{f}_y}{\partial u}\frac{\partial u}{\partial x} +
    \frac{\partial\mathbf{f}_y}{\partial v}\frac{\partial v}{\partial x} \\
    
    \frac{\partial\mathbf{f}_x}{\partial u}\frac{\partial u}{\partial y} +
    \frac{\partial\mathbf{f}_x}{\partial v}\frac{\partial v}{\partial y} &
    
    \frac{\partial\mathbf{f}_y}{\partial u}\frac{\partial u}{\partial y} +
    \frac{\partial\mathbf{f}_y}{\partial v}\frac{\partial v}{\partial y}
\end{pmatrix}
=
\begin{pmatrix}
	\frac{\partial u}{\partial x} & \frac{\partial v}{\partial x} \\
	\frac{\partial v}{\partial y} & \frac{\partial v}{\partial y}
\end{pmatrix}
\begin{pmatrix}
    \frac{\partial\mathbf{f}_x}{\partial u} & \frac{\partial\mathbf{f}_y}{\partial u} \\
    \frac{\partial\mathbf{f}_x}{\partial v} & \frac{\partial\mathbf{f}_y}{\partial v}
\end{pmatrix}
=
\mathbf{J}^T
\nabla\mathbf{g}
$$

